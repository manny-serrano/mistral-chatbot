<?xml version="1.0" encoding="UTF-8"?>
<SecurityPolicyProvider type="XML" validate="true" xmlns="urn:mace:shibboleth:3.0:native:sp:config"
    xmlns:conf="urn:mace:shibboleth:3.0:native:sp:config"
    xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"
    xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
    xmlns:md="urn:oasis:names:tc:SAML:2.0:metadata">

    <!-- Default security policy for SAML interactions -->
    <SecurityPolicy>
        <PolicyRule type="SimpleSecurityPolicy">
            <!-- Relaxed signature verification for Duke IdP compatibility -->
            <Rule type="Signature" required="false"/>
            
            <!-- Extended message lifetime policy (10 minutes for clock skew) -->
            <Rule type="MessageLifetime" clockSkew="600"/>
            
            <!-- Replay detection policy -->
            <Rule type="MessageReplay" checkReplay="true"/>
            
            <!-- Client certificate policy (not required) -->
            <Rule type="ClientCertAuth" required="false"/>
            
            <!-- IP address validation (disabled for Duke network) -->
            <Rule type="IPAddressRule" required="false"/>
        </PolicyRule>
    </SecurityPolicy>
    
    <!-- Specific policy for authentication requests -->
    <SecurityPolicy id="AuthnRequest">
        <PolicyRule type="SimpleSecurityPolicy">
            <Rule type="Signature" required="false"/>
            <Rule type="MessageLifetime" clockSkew="300"/>
            <Rule type="MessageReplay" checkReplay="true"/>
        </PolicyRule>
    </SecurityPolicy>
    
    <!-- Specific policy for logout requests -->
    <SecurityPolicy id="LogoutRequest">
        <PolicyRule type="SimpleSecurityPolicy">
            <Rule type="Signature" required="true"/>
            <Rule type="MessageLifetime" clockSkew="300"/>
            <Rule type="MessageReplay" checkReplay="true"/>
        </PolicyRule>
    </SecurityPolicy>

    <!-- Specific policy for SAML2 POST responses (Duke IdP) -->
    <SecurityPolicy id="SAML2POST">
        <PolicyRule type="SimpleSecurityPolicy">
            <!-- Very relaxed policy for Duke SAML responses -->
            <Rule type="Signature" required="false"/>
            <Rule type="MessageLifetime" clockSkew="600"/>
            <Rule type="MessageReplay" checkReplay="false"/>
        </PolicyRule>
    </SecurityPolicy>

</SecurityPolicyProvider>
